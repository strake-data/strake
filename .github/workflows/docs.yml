name: docs
on:
  push:
    branches:
      - main
    paths:
      - 'docs/**'
      - 'mkdocs.yml'
      - '.github/workflows/docs.yml'

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Generate Token
        id: generate-token
        uses: actions/create-github-app-token@v1
        with:
          app-id: ${{ secrets.GH_APP_ID }}
          private-key: ${{ secrets.GH_APP_PRIVATE_KEY }}
          owner: ${{ github.repository_owner }}

      - uses: actions/checkout@v4
        with:
          submodules: 'recursive'
          token: ${{ steps.generate-token.outputs.token }}
          fetch-depth: 0
          persist-credentials: true

      - name: Configure Git Credentials
        run: |
          git config user.name github-actions[bot]
          git config user.email 41898282+github-actions[bot]@users.noreply.github.com
          git remote set-url origin https://x-access-token:${{ steps.generate-token.outputs.token }}@github.com/${{ github.repository }}.git

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install mkdocs-material mkdocs-redirects mkdocs-minify-plugin

      - name: Deploy to GitHub Pages
        run: |
          # Use mkdocs gh-deploy to push to gh-pages branch
          # We are in the root of the 'strake' directory (relative to the repo root)
          # Assuming the workflow is running from the repo root.
          # If 'strake' is a subdirectory, we might need to cd into it.
          # Based on the file paths, 'strake' seems to be a directory in the repo.
          # Let's check the pwd and list files if unsure.
          mkdocs gh-deploy --force --config-file mkdocs.yml
